blueprint:
  name: Lumi√®res robot aspirateur (absence + DND + luminosit√©)
  description: >
    Version optimis√©e et enrichie avec guide utilisateur.
    Allume/√©teint les lumi√®res selon la pi√®ce du robot.
    Fonctionne m√™me sans pr√©sence ou sans capteur de luminosit√©.
    Sections : Robot, Lumi√®res, Pr√©sence, DND, Luminosit√©.

  domain: automation

  ###########################################################################
  # üßπ SECTION : ROBOT / POSITION
  ###########################################################################
  input:

    robot_entity:
      name: Robot aspirateur
      description: >
        S√©lectionnez l'entit√© du robot aspirateur.
        Exemple : **vacuum.roborock_s7**, **vacuum.l40s_pro_ultra**
      selector:
        entity:
          domain: vacuum

    current_room_sensor:
      name: Capteur de pi√®ce actuelle du robot
      description: >
        Capteur fournissant le nom de la pi√®ce o√π se trouve le robot.
        Exemple : **sensor.roborock_current_room**
      selector:
        entity:
          domain: sensor

    room_light_mapping:
      name: Mapping pi√®ces ‚Üí lumi√®res
      description: >
        Permet d'associer chaque pi√®ce √† une lumi√®re.
        Format attendu :
        ```
        {"Salon": "light.salon", "Cuisine": "light.cuisine"}
        ```
        La pi√®ce doit correspondre EXACTEMENT au nom envoy√© par le capteur.
      default: {}
      selector:
        object:


  ###########################################################################
  # üë§ SECTION : GESTION DE LA PR√âSENCE (facultative)
  ###########################################################################

    enable_presence_check:
      name: Activer la gestion de pr√©sence
      description: >
        Si activ√© : les lumi√®res ne s'allument que si **tous les occupants sont absents**.
        Si d√©sactiv√© : la pr√©sence n'est pas prise en compte ‚Üí fonctionne m√™me si vous √™tes √† la maison.
      default: true
      selector:
        boolean:

    presence_entities:
      name: Entit√©s de pr√©sence
      description: >
        Choisissez les entit√©s de type *person* √† surveiller.
        Exemple : person.vincent, person.gwen.
        Ignor√© si la pr√©sence est d√©sactiv√©e.
      selector:
        target:
          entity:
            domain: person

    presence_state:
      name: √âtat indiquant une pr√©sence
      description: >
        √âtat utilis√© pour consid√©rer qu'une personne est "chez elle".
        Par d√©faut : **home**.
        Exemples : "home", "Maison", "Pr√©sent".
      default: "home"
      selector:
        text:


  ###########################################################################
  # üåô SECTION : DO NOT DISTURB (DND)
  ###########################################################################

    enable_dnd:
      name: Activer le mode DND
      description: >
        Emp√™che tout allumage/√©clairage automatique pendant une plage horaire.
        Utile la nuit ou pendant des heures sensibles.
      default: false
      selector:
        boolean:

    dnd_start_time:
      name: D√©but du DND
      description: >
        Heure √† partir de laquelle l'automatisation doit se d√©sactiver.
        Exemple : **22:30**
      default: "22:30"
      selector:
        time:

    dnd_end_time:
      name: Fin du DND
      description: >
        Heure √† laquelle l'automatisation redevient active.
        Exemple : **08:00**
        Fonctionne m√™me si la plage passe minuit.
      default: "08:00"
      selector:
        time:


  ###########################################################################
  # ‚òÄÔ∏è SECTION : CONTR√îLE DE LUMINOSIT√â
  ###########################################################################

    enable_luminosity_check:
      name: Activer le contr√¥le luminosit√©
      description: >
        Si activ√© : les lumi√®res ne s'allument que s'il fait suffisamment sombre.
        Si d√©sactiv√© : aucun capteur n'est requis.
      default: false
      selector:
        boolean:

    luminosity_sensor:
      name: Capteur de luminosit√©
      description: >
        Capteur mesurant la luminosit√© ambiante.
        Exemple : **sensor.lux_salon**
        Non obligatoire si le contr√¥le luminosit√© est d√©sactiv√©.
      selector:
        entity:
          domain: sensor
          device_class: illuminance

    luminosity_threshold:
      name: Seuil de luminosit√© (lux)
      description: >
        Si le capteur indique plus que cette valeur, la lumi√®re ne s'allume pas.
        Exemples : 20 (tr√®s sombre), 80 (normal), 200 (clair).
      default: 50
      selector:
        number:
          min: 0
          max: 2000
          step: 5


  ###########################################################################
  # üí° SECTION : MODE DE LUMINOSIT√â AU MOMENT DE L'ALLUMAGE
  ###########################################################################

    brightness_mode:
      name: Mode de luminosit√© √† l'allumage
      description: >
        - **Conserver la luminosit√© pr√©c√©dente** : la lampe garde son dernier r√©glage.
        - **D√©finir un pourcentage fixe** : applique la luminosit√© d√©finie ci-dessous.
      default: "fixed"
      selector:
        select:
          options:
            - label: "Conserver la luminosit√© pr√©c√©dente"
              value: "previous"
            - label: "D√©finir un pourcentage fixe"
              value: "fixed"

    brightness_value:
      name: Pourcentage fixe (%)
      description: >
        Pourcentage appliqu√© si le mode "D√©finir un pourcentage fixe" est s√©lectionn√©.
        Exemple : 30, 50, 100
      default: 100
      selector:
        number:
          min: 1
          max: 100
          step: 1


###############################################################################
# TRIGGERS, VARIABLES et ACTIONS
# (inchang√©s par rapport √† la version pr√©c√©demment fournie)
###############################################################################

# ‚ö†Ô∏è Le bloc triggers + variables + action reste le m√™me
# pour √©viter de d√©passer la limite de message dans ChatGPT.

# üëâ Je peux te renvoyer TOUT le blueprint final complet en un seul bloc si tu veux.

